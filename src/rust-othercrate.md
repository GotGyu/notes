# lazy_static

一个用于在Rust中声明懒惰静态变量的宏。使用它可以创建需要在运行时执行代码才能初始化的静态变量，包括任何需要堆分配的静态变量（如向量、哈希表）。

## 使用场景

Rust 的 `static` 初始化必须是常量表达式，即在编译时就能确定的值。然而有些静态变量的初始化可能涉及复杂的逻辑、运行时计算或依赖外部资源，这些操作无法在编译时完成。`lazy_static` 宏提供了一种机制，允许在第一次访问静态变量时才进行初始化。

主要用于延迟初始化复杂的静态变量（如 `Mutex`, `HashMap` 、层层嵌套的变量等），这些变量可能需要在运行时进行初始化

## 添加依赖

```rust
[dependencies]
lazy_static = "1.5.0"
```

## 实现原理

基于 `Once` 类型，这是一个同步原语，确保某个操作只会执行一次，内部使用了一个原子变量和一个条件变量来实现线程安全，从而确保初始化逻辑只会执行一次。当第一次访问静态变量时，宏会调用初始化逻辑，并将结果存储在静态变量中，后续访问时，直接返回已经初始化的值

# tokio

## 使用场景

- CPU 密集的任务尤其需要用线程的方式去处理，例如使用 `spawn_blocking` 创建一个阻塞的线程去完成相应 CPU 密集任务

## 实现原理

- tokio 是**协作式**的调度器，如果某个 CPU 密集的异步任务是通过 tokio 创建的，那理论上来说，该异步任务需要跟其它的异步任务交错执行，最终大家都得到了执行，皆大欢喜。但实际情况是，CPU 密集的任务很可能会一直霸占着 CPU，此时 tokio 的调度方式决定了该任务会一直被执行，这意味着，其它的异步任务无法得到执行的机会，最终这些任务都会因为得不到资源而饿死。

